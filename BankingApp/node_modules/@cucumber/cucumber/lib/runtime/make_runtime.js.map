{"version":3,"file":"make_runtime.js","sourceRoot":"","sources":["../../src/runtime/make_runtime.ts"],"names":[],"mappings":";;;;;AAaA,kCAsCC;AA7CD,mEAAmD;AAGnD,gDAAwD;AACxD,8CAAmD;AACnD,+CAA2C;AAEpC,KAAK,UAAU,WAAW,CAAC,EAChC,WAAW,EACX,MAAM,EACN,gBAAgB,EAChB,cAAc,EACd,KAAK,EACL,kBAAkB,EAClB,OAAO,EACP,cAAc,GAUf;IACC,MAAM,gBAAgB,GAAG,KAAK,EAAE,CAAA;IAChC,MAAM,OAAO,GAAG,MAAM,WAAW,CAC/B,OAAO,EACP,cAAc,EACd,gBAAgB,EAChB,WAAW,EACX,MAAM,EACN,gBAAgB,EAChB,kBAAkB,EAClB,KAAK,CACN,CAAA;IACD,OAAO,IAAI,yBAAW,CACpB,gBAAgB,EAChB,gBAAgB,EAChB,KAAK,EACL,cAAc,EACd,kBAAkB,EAClB,OAAO,CACR,CAAA;AACH,CAAC;AAED,KAAK,UAAU,WAAW,CACxB,OAA2B,EAC3B,cAAyE,EACzE,gBAAwB,EACxB,WAA4B,EAC5B,MAAe,EACf,gBAA8B,EAC9B,kBAAsC,EACtC,KAAmB;IAEnB,IAAI,OAAO,CAAC,QAAQ,GAAG,CAAC,EAAE,CAAC;QACzB,OAAO,IAAI,6BAAmB,CAC5B,gBAAgB,EAChB,WAAW,EACX,MAAM,EACN,gBAAgB,EAChB,OAAO,EACP,cAAc,EACd,kBAAkB,CACnB,CAAA;IACH,CAAC;IACD,MAAM,cAAc,GAAG,MAAM,iBAAgB,CAAC,+BAA+B,CAC3E;QACE,GAAG,EAAE,WAAW,CAAC,GAAG;QACpB,gBAAgB,EAAE,cAAc,CAAC,gBAAgB;QACjD,aAAa,EAAE,cAAc,CAAC,aAAa;QAC3C,kBAAkB;KACnB,CACF,CAAA;IACD,OAAO,IAAI,0BAAgB,CACzB,gBAAgB,EAChB,gBAAgB,EAChB,KAAK,EACL,OAAO,EACP,kBAAkB,EAClB,cAAc,CACf,CAAA;AACH,CAAC","sourcesContent":["import { EventEmitter } from 'node:events'\nimport { IdGenerator } from '@cucumber/messages'\nimport { IRunOptionsRuntime } from '../api'\nimport { ILogger, IRunEnvironment } from '../environment'\nimport { SourcedPickle } from '../assemble'\nimport { SupportCodeLibrary } from '../support_code_library_builder/types'\nimport FormatterBuilder from '../formatter/builder'\nimport { FormatOptions } from '../formatter'\nimport { Runtime } from './types'\nimport { ChildProcessAdapter } from './parallel/adapter'\nimport { InProcessAdapter } from './serial/adapter'\nimport { Coordinator } from './coordinator'\n\nexport async function makeRuntime({\n  environment,\n  logger,\n  eventBroadcaster,\n  sourcedPickles,\n  newId,\n  supportCodeLibrary,\n  options,\n  snippetOptions,\n}: {\n  environment: IRunEnvironment\n  logger: ILogger\n  eventBroadcaster: EventEmitter\n  newId: IdGenerator.NewId\n  sourcedPickles: ReadonlyArray<SourcedPickle>\n  supportCodeLibrary: SupportCodeLibrary\n  options: IRunOptionsRuntime\n  snippetOptions: Pick<FormatOptions, 'snippetInterface' | 'snippetSyntax'>\n}): Promise<Runtime> {\n  const testRunStartedId = newId()\n  const adapter = await makeAdapter(\n    options,\n    snippetOptions,\n    testRunStartedId,\n    environment,\n    logger,\n    eventBroadcaster,\n    supportCodeLibrary,\n    newId\n  )\n  return new Coordinator(\n    testRunStartedId,\n    eventBroadcaster,\n    newId,\n    sourcedPickles,\n    supportCodeLibrary,\n    adapter\n  )\n}\n\nasync function makeAdapter(\n  options: IRunOptionsRuntime,\n  snippetOptions: Pick<FormatOptions, 'snippetInterface' | 'snippetSyntax'>,\n  testRunStartedId: string,\n  environment: IRunEnvironment,\n  logger: ILogger,\n  eventBroadcaster: EventEmitter,\n  supportCodeLibrary: SupportCodeLibrary,\n  newId: () => string\n) {\n  if (options.parallel > 0) {\n    return new ChildProcessAdapter(\n      testRunStartedId,\n      environment,\n      logger,\n      eventBroadcaster,\n      options,\n      snippetOptions,\n      supportCodeLibrary\n    )\n  }\n  const snippetBuilder = await FormatterBuilder.getStepDefinitionSnippetBuilder(\n    {\n      cwd: environment.cwd,\n      snippetInterface: snippetOptions.snippetInterface,\n      snippetSyntax: snippetOptions.snippetSyntax,\n      supportCodeLibrary,\n    }\n  )\n  return new InProcessAdapter(\n    testRunStartedId,\n    eventBroadcaster,\n    newId,\n    options,\n    supportCodeLibrary,\n    snippetBuilder\n  )\n}\n"]}